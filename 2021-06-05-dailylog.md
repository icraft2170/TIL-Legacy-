---
title: 06.05일 ( studylog )
author : 손현호
date: 2021-06-05
---


# 쓰레드( Thread )

### 프로세스(Process)
- 프로그램이 하드디스크에서 메모리로 로드 되어 실행 했을 때 프로세스가 된다.
- `실행중인 프로그램` 이라고 보면 된다.
- 데이터, 메모리와 같은 `자원`, `쓰레드`로 구성되어 있다.
### 쓰레드와 구현과 실행

#### 쓰레드
- 프로세스의 자원을 이용하여 실제 작업을 수행하는 것이 `쓰레드`임.
- 모든 프로세스에는 최소 한 개의 쓰레드를 포함한다.
- 단일 쓰레드를 `싱글 쓰레드` 다 수의 쓰레드를 지닌 것을 `멀티 쓰레드`라고 한다.
- 하나의 쓰레드는 하나의 `호출 스택(메모리 공간)`을 지님.

#### 멀티태스킹과 멀티쓰레딩
- 멀티태스킹(multi-tasking 다중작업) : 여러 개의 프로세스를 동시에 실행하는 것
- 멀티쓰레딩(mulit-threading) : 여러 개의 쓰레드를 동시에 실행하는 것
    - `장점`
    - CPU의 사용률을 향상시킨다.
    - 자원을 보다 효율적으로 사용
    - 사용자에 대한 응답성 향상
    - 작업 분리로 코드간결
    - `단점`
    - 여러 쓰레드가 같은 프로세스의 자원을 공유하면서 `동기화` 혹은 `교착상태`의 문제가 발생
    - 교착상태: 두 쓰레드가 서로가 가진 자원을 필요로 하여 대기하고 있는 상태

    >사실 하나의 core(코어)는 한 번에 하나의 작업만 할 수 있어. 쓰레드가 동시에 실행되는 것이 아니라, 서로 번갈아가며 쓰레드를 실행하는 것이라고 볼 수 있다. 단순 작업에서 멀티쓰레딩 보다는 싱글쓰레드로 작업하는 것이 효율이 좋을 수 있다.

#### 쓰레드 구현

1. Tread클래스 상속 후 run을 오버라이딩 하여 사용
```java
class MyThread extends Tread{
    public void run(){
        //오버라이딩
    }
}

main(){
    MyTread thread01 = new MyTread();

    thread01.start();
    // 호출 스택 생성
    thread01.run()
    // 새로 만든 호출 스택의 최하단 메서드로 run() 지정
}
```
2. Runnable 인터페이스를 구현 후 관련 클래스 객체를 생성하여 Tread형으로 형변환 하여 사용한다. 같은 행위를 하는 run()이라는 메서드를 외부에서 추가한다고 볼 수 있다. 단일 상속만을 허용 하는 자바에서는 일반적인 사용법이라고 볼 수 있다.
```java
class MyThread impleaments Runnalbe {
    public void run(){
        //구현
    }
}

main(){
    Runnable runnable01 = new MyTread();
    Thread thread01 = new Thread(runnalbe01);
    //Thread thread01 = new Thread(new MyTread()); 하나로 합칠 수 있다.

    thread01.start();
    thread01.run()
}
```

1번 방법은 Thread 클래스의 하위 클래스를 만들어 run() 오버라이딩 해서 사용하는 방법이고 2번 방법은 run()이라는 메서드를 가진 Runnable을 구현하여 run()이라는 메서드를 가진 해당 클래스의 객체를 Thread 객체의 생성자의 매개변수로 넣어줌으로서 일련의 과정을 통해 진행하는 방법이다. 2번방법을 이해하기 위해 Thread 클래스를 재현해 보면

```java
public class Thread
    private Runnable r;

    public Tread(Runnable r){
        this.r = r;
    }

    public void run(){
        if(r != null)
            r.run();
    }

```
위와 같이 `Runnalbe type` 을 생성자가 받았다면 Thread의 run 실행시 우리가 구현한 클래스의 run() 메서드를 실행하도록 함으로서 쓰레드를 구현하고 실행 할 수 있는 것이다.

`Runnable`을 통해 구현하면 자손 클래스에서 Thread클래스의 메서드를 직접 호출 할 수 없고 static 메서드인 `currentThread()`를 통해 쓰레드의 참조를 반환받아서 호출이 가능하다.

### start() , run()

- start() 메서드의 경우 Thread가 사용할 호출 스택을 생성해주는 메서드

- run() 메서드의 경우 단순히 클래스에 선언된 메서드를 호출하는 것이다

```java
    thread01.start();
    thread01.run()
```

따라서 위와 같이 쓰는 것은 `start()로 쓰레드를 생성하고 호출스택`을 생성한 후 `run()을 생성한 쓰레드의 호출스택 최하단에 위치시킨다.` start()를 해주지 않으면 메인메서드가 run()을 호출하여 메인쓰레드에서 호출되는 것으로 새로운 쓰레드 생성은 없다.

- `프로그램은 실행 중인 사용자 쓰레드가 하나도 없을 때 종료된다.`


### 싱글 쓰레드와 멀티 쓰레드

싱글코어에서 싱글 쓰레드건 멀티 쓰레드건 한 번에는 하나의 작업만 수행 할 수 있다. 다만 싱글 쓰레드는 절차에 맞게 하나를 하고 다음 것을 하는 반면 멀티 쓰레드는 두 가지 작업을 준비해두고 스케쥴러가 정해준 순서대로 돌아가면서 일을 처리한다. 이리 하여 두가지 작업을 동시에 진행 할 수 있는데 다운을 받으며 채팅을 치는 것과 같은 내용을 단일 쓰레드로 작성하면 다운 할 때는 채팅을 칠 수 없고 채팅을 치는 중에는 다운을 받을 수 없을 것이다. 물론 멀티 쓰레드 역시 싱글코어에서 한 번에 하나의 작업만 하지만 CPU의 효율을 높여 쓰레드 스위칭을 해가면서 동시에 작업을 진행하여 효과를 높인다. 

#### 싱글 쓰레드

- 하나의 쓰레드로 작업을 하는 것
- 싱글 코어에서는 쓰레드간의 전환(context switching)작업이 없어 멀는 싱글 쓰레드가 쓰레드보다 시간 효율이 좋을 수 도 있다.


#### 멀티 쓰레드
- 멀티코어에서는 동시에 `병렬`(다수의 코어로 쓰레드의 작업이 동시에 진행되는 형태) 형태로 진행며 싱글 코어에서는 `병행` ( 하나의 코어로 쓰레드 간의 작업이 겹치지 않고  작업하는 형태)
- 동시 작업이 가능한 멀티코어에서 효율이 좋다.
- 작업의 스위칭 순서 혹은 방법은 OS 프로세스 스케줄러의 영향을 받아 실행 시 마다 달라지며 이러한 불확실성이 존재한다.
- 두 쓰레드가 프로세스내의 다른 자원을 사용한다면 싱글 스레드보다 멀티쓰레드가 효율적이다.


### 쓰레드의 우선순위

- 쓰레드는 우선순위(priority)라는 멤버변수를 가지고있어 우선 순위를 1~10까지 지정할 수 있다.
- 10이 가장 크며 setPriority(우선순위);/int 우선순위 = getPriority() 와 같은 메서드로 확인 가능.
- 다만 위의 우선순위는 OS 프로세스 스케쥴러에 전달하는 희망사항일 뿐 반드시 지켜지는 사항은 아니고 우선순위 결정은 OS 프로세스 스케쥴러가 진행한다.
- 쓰레드 실행 이전에만 사용 가능


### 쓰레드 그룹

- 모든 쓰레드는 그룹을 가지며, 쓰레드 그룹 또한 그를 포함하는 그룹을 가질 수 있다.
- 쓰레드그룹을 지정하지 않으면 자신을 생성한 쓰레드와 같은 쓰레드 그룹에 속한다.
- JVM은 main쓰레드 그룹과 system쓰레드 그룹을 생성하며 모든 사용자 사용 쓰레드 그룹은 메인 쓰레드 그룹의 하위에 존재한다.
- 쓰레드 그룹또한 우선순위 지정이 가능하고

### 데몬 쓰레드